<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{admin/layout}">
<head>
    <title>Quản lý bình luận</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
<div layout:fragment="content" class="container-fluid">
    <h1 class="h3 mb-4 text-primary">Quản lý bình luận</h1>

    <!-- Thông báo -->
    <div th:if="${successMessage}" class="alert alert-success" role="alert" th:text="${successMessage}"></div>
    <div th:if="${errorMessage}" class="alert alert-danger" role="alert" th:text="${errorMessage}"></div>

    <!-- Thanh tìm kiếm -->
        <div class="w-25 mb-4 shadow-sm">
            <form th:action="@{/comments/}" method="get">
                <div class="input-group">
                    <input type="text" class="form-control" name="keyword" th:value="${keyword}" placeholder="Tìm kiếm theo nội dung..."/>
                    <button class="btn btn-primary " type="submit"><i class="fas fa-search"></i></button>
                </div>
            </form>
        </div>


    <!-- Danh sách bình luận -->
    <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
            <h6 class="mb-0">Danh sách bình luận</h6>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-primary">
                    <tr>
                        <th>ID</th>
                        <th>Product</th>
                        <th>Customer</th>
                        <th>Content</th>
                        <th>Date</th>
<!--                        <th>Cập nhật</th>-->
<!--                        <th>Thao tác</th>-->
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="comment : ${comments}">
                        <td th:text="${comment.id}"></td>
                        <td>
                            <a th:href="@{'/products/detail/' + ${comment.product.productId}}" class="text-decoration-none" target="_blank">
                                <span th:text="${comment.product.productName}" class="text-primary"></span>
                            </a>
                        </td>
                        <td th:text="${comment.user.username}"></td>
                        <td>

                            <button class="btn btn-sm  mt-1" data-bs-toggle="modal" th:data-bs-target="'#viewContentModal-' + ${comment.id}">
                                <span th:text="${comment.content.length() > 50 ? comment.content.substring(0, 50) + '...' : comment.content}"></span>
                            </button>

                            <!-- Modal xem nội dung -->
                            <div class="modal fade" th:id="'viewContentModal-' + ${comment.id}" tabindex="-1" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title">Nội dung bình luận</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            <p th:text="${comment.content}"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td th:text="${#temporals.format(comment.createdAt, 'dd/MM/yyyy HH:mm')}"></td>
<!--                        <td th:text="${comment.updatedAt != null ? #temporals.format(comment.updatedAt, 'dd/MM/yyyy HH:mm') : '-'}"></td>-->
<!--                        <td>-->
<!--                            <a th:href="@{'/comments/admin/delete/' + ${comment.id}}" class="btn btn-danger btn-sm" onclick="return confirm('Bạn có chắc chắn muốn xóa bình luận này?')">-->
<!--                                <i class="fas fa-trash"></i>-->
<!--                            </a>-->
<!--                        </td>-->
                    </tr>
                    <tr th:if="${comments.isEmpty()}">
                        <td colspan="7" class="text-center">Không có bình luận nào</td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <div class="d-flex justify-content-center mt-3">
                <ul class="pagination">
                    <li class="page-item" th:classappend="${comments.first} ? 'disabled' : ''">
                        <a class="page-link" th:href="@{/comments/(page=0, size=${comments.size}, keyword=${keyword})}">«</a>
                    </li>
                    <li class="page-item" th:each="i : ${#numbers.sequence(0, comments.totalPages - 1)}"
                        th:classappend="${i == comments.number} ? 'active' : ''">
                        <a class="page-link" th:href="@{/comments/(page=${i}, size=${comments.size}, keyword=${keyword})}" th:text="${i + 1}"></a>
                    </li>
                    <li class="page-item" th:classappend="${comments.last} ? 'disabled' : ''">
                        <a class="page-link" th:href="@{/comments/(page=${comments.totalPages - 1}, size=${comments.size}, keyword=${keyword})}">»</a>
                    </li>
                </ul>
            </div>

        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>